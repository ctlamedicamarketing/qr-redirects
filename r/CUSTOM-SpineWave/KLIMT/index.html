<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KLIMT • Video + PDF Downloads</title>
<meta name="robots" content="noindex, nofollow" />
<style>
  :root{
    --bg:#0b0c10; --panel:#0d111a; --ink:#e8eaed; --muted:#9aa0a6;
    --stroke:#1e2330; --accent:#ffc81a;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);
            font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  a{color:var(--ink)}
  .wrap{min-height:100%;display:grid;grid-template-rows:auto 1fr auto;gap:16px;max-width:1200px;margin:0 auto;padding:16px}
  header.app{display:flex;gap:10px;align-items:center;justify-content:space-between;padding-bottom:8px;border-bottom:1px solid var(--stroke)}
  header.app h1{margin:0;font-size:18px;font-weight:700;letter-spacing:.02em}
  .btn{appearance:none;border:1px solid var(--stroke);background:linear-gradient(180deg,#0f1320,#0b0f1b);
       color:var(--ink);padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600;text-decoration:none}
  .btn:hover{border-color:var(--accent)}
  .grid{display:grid;grid-template-columns:1fr 1.4fr;gap:16px}
  @media (max-width:980px){.grid{grid-template-columns:1fr}}
  .card{background:var(--panel);border:1px solid var(--stroke);border-radius:14px;overflow:hidden;display:flex;flex-direction:column}
  .card .head{display:flex;align-items:center;gap:10px;justify-content:space-between;padding:12px;border-bottom:1px solid var(--stroke)}
  .card .head h2{margin:0;font-size:14px;font-weight:700}
  .frame{position:relative;aspect-ratio:16/9;width:100%;background:#000}
  .frame > iframe{position:absolute;inset:0;width:100%;height:100%;border:0}
  .list{padding:12px; display:grid; gap:12px}
  .item{display:flex;align-items:center;gap:12px;flex-wrap:wrap;border:1px solid var(--stroke);border-radius:12px;padding:10px}
  .item h3{margin:0;font-size:14px}
  .muted{color:var(--muted)}
  details.debug{padding:8px 12px;border-top:1px dashed var(--stroke);font-size:12px;color:var(--muted)}
  footer{display:flex;justify-content:flex-end;gap:10px;align-items:center;padding-top:8px;border-top:1px solid var(--stroke)}
</style>
</head>
<body>
<div class="wrap">

  <!-- Top -->
  <header class="app">
    <h1>KLIMT — Video & PDF Downloads</h1>
  </header>

  <!-- Main -->
  <div class="grid">

    <!-- Left: YouTube -->
    <section class="card" aria-label="Video">
      <div class="head"><h2>Product Teaser</h2></div>
      <div class="frame">
        <iframe id="yt" title="YouTube video" allow="autoplay; encrypted-media; picture-in-picture; web-share"
                allowfullscreen loading="lazy" referrerpolicy="strict-origin-when-cross-origin"></iframe>
      </div>
    </section>

    <!-- Right: PDFs (only force-download buttons) -->
    <section class="card" aria-label="Documents">
      <div class="head">
        <h2>Documents</h2>
      </div>

      <div id="docList" class="list" aria-live="polite"></div>

      <details class="debug" id="debug">
        <summary>Debug</summary>
        <div id="debugBody">Ready.</div>
      </details>
    </section>
  </div>

  <!-- Bottom -->
  <footer>
    <div class="muted">Downloads use fetch+blob for reliable saving.</div>
  </footer>
</div>

<script>
  /* ========================== CONFIG — EDIT THESE ==========================
   *
   * 1) YOUTUBE VIDEO
   *    Replace YT_ID with the 11-character ID from your video URL.
   *    Example: https://www.youtube.com/watch?v=cLHOGWiA6YQ -> "cLHOGWiA6YQ"
   *
   * 2) PDF LOCATIONS (DOCS array)
   *    Choose ONE style per 'path':
   *      a) Relative (same folder or subfolder): "KLIMT-STG.pdf" or "docs/KLIMT-STG.pdf"
   *      b) Site-root (GitHub Pages): "/qr-redirects/docs/KLIMT-STG.pdf"
   *      c) Raw GitHub (direct file in repo): 
   *         "https://raw.githubusercontent.com/<user>/<repo>/<branch>/<path/to/file.pdf>"
   *
   *    IMPORTANT:
   *      • Use **raw.githubusercontent.com** or **GitHub Pages** for cross-origin downloads.
   *        (Do NOT use the GitHub “blob” page URLs—those are HTML pages and will fail.)
   *      • Filenames on Pages are case-sensitive.
   * ======================================================================= */

  const YT_ID = "cLHOGWiA6YQ";  // <-- EDIT for your YouTube video

  const DOCS = [
    { label:"KLIMT STG",                    path:"KLIMT-STG.pdf",                            filename:"KLIMT-STG.pdf" },
    { label:"Klimt Expansion Table & Tips", path:"Klimt-Expansion-table-and-Tips.pdf",       filename:"Klimt-Expansion-Table-and-Tips.pdf" },
    { label:"Klimt Expansion Table",        path:"Klimt-Expansion-table.pdf",                filename:"Klimt-Expansion-Table.pdf" }
    // Add more:
    // { label:"KLIMT Brochure", path:"/qr-redirects/docs/klimt-brochure.pdf", filename:"KLIMT-Brochure.pdf" }
  ];

  /* ============================ END CONFIG ============================ */

  // --------- YouTube init ----------
  (function initYouTube(){
    const yt = document.getElementById('yt');
    const origin = location.origin;
    const params = new URLSearchParams({
      autoplay:'0', mute:'1', controls:'1', modestbranding:'1', rel:'0',
      playsinline:'1', loop:'1', playlist:YT_ID, enablejsapi:'1', origin
    });
    yt.src = `https://www.youtube.com/embed/${YT_ID}?` + params.toString();
  })();

  // --------- Helpers ----------
  function absUrl(p){
    try { return new URL(p, location.href).toString(); }
    catch { return p; }
  }

  // Try to infer a filename from headers or URL if none provided
  function inferFilename(url, headers, fallback){
    // Content-Disposition: attachment; filename="example.pdf"
    const cd = headers.get('content-disposition');
    if (cd) {
      const m = cd.match(/filename\*?=(?:UTF-8''|")?([^\";]+)\"?/i);
      if (m && m[1]) {
        try { return decodeURIComponent(m[1]); } catch { return m[1]; }
      }
    }
    // URL path segment
    try {
      const u = new URL(url);
      const last = u.pathname.split('/').pop();
      if (last && /\./.test(last)) return last;
    } catch {}
    return fallback || 'download.pdf';
  }

  // Force-download via fetch -> blob -> temporary object URL
  async function forceDownload(url, suggestedName, btn){
    const originalText = btn.textContent;
    btn.textContent = "Downloading…";
    btn.disabled = true;

    try{
      const res = await fetch(url, { mode:'cors', credentials:'omit', cache:'no-store' });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const blob = await res.blob();

      const filename = inferFilename(url, res.headers, suggestedName);
      const a = document.createElement('a');
      const objectUrl = URL.createObjectURL(blob);
      a.href = objectUrl;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(objectUrl);

      btn.textContent = "Downloaded ✓";
    } catch (err){
      // Graceful fallback: open in a new tab (user can save manually)
      console.warn('Force download failed, opening instead:', err);
      window.open(url, '_blank', 'noopener');
      btn.textContent = "Opened in new tab";
    } finally {
      setTimeout(()=>{ btn.textContent = originalText; btn.disabled = false; }, 1800);
    }
  }

  async function headOk(url){
    try{
      const res = await fetch(url, { method:'HEAD', cache:'no-store', mode:'cors' });
      return res.ok;
    }catch{ return false; }
  }

  // --------- Build Download List ----------
  const els = {
    docList:   document.getElementById("docList"),
    debugBody: document.getElementById("debugBody")
  };

  async function populateDocs(){
    for (const d of DOCS){
      const url = absUrl(d.path);

      const row = document.createElement("div");
      row.className = "item";

      const title = document.createElement("h3");
      title.textContent = d.label;

      const download = document.createElement("button");
      download.className = "btn";
      download.type = "button";
      download.textContent = "Download";
      download.addEventListener('click', ()=> forceDownload(url, d.filename || (d.label.replace(/\s+/g,"_") + ".pdf"), download));

      row.appendChild(title);
      row.appendChild(download);
      els.docList.appendChild(row);

      // Debug info line (helpful during setup)
      const ok = await headOk(url);
      const p = document.createElement("p");
      p.innerHTML = `• <b>${d.label}</b>: <a href="${url}" target="_blank" rel="noopener">${url}</a> ${ok ? "✅ reachable" : "⚠️ HEAD failed (check CORS/path)"}`
      els.debugBody.appendChild(p);
    }
  }

  populateDocs();
</script>
</body>
</html>
