<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>KLIMT • Video + PDF Downloads</title>
<meta name="robots" content="noindex, nofollow" />
<style>
  :root{
    --bg:#0b0c10; --panel:#0d111a; --ink:#e8eaed; --muted:#9aa0a6;
    --stroke:#1e2330; --accent:#ffc81a;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);
            font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  a{color:var(--ink)}
  .wrap{min-height:100%;display:grid;grid-template-rows:auto 1fr auto;gap:16px;max-width:1200px;margin:0 auto;padding:16px}
  header.app{display:flex;gap:10px;align-items:center;justify-content:space-between;padding-bottom:8px;border-bottom:1px solid var(--stroke)}
  header.app h1{margin:0;font-size:18px;font-weight:700;letter-spacing:.02em}
  .btn{appearance:none;border:1px solid var(--stroke);background:linear-gradient(180deg,#0f1320,#0b0f1b);
       color:var(--ink);padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600;text-decoration:none}
  .btn:hover{border-color:var(--accent)}
  .grid{display:grid;grid-template-columns:1fr 1.4fr;gap:16px}
  @media (max-width:980px){.grid{grid-template-columns:1fr}}
  .card{background:var(--panel);border:1px solid var(--stroke);border-radius:14px;overflow:hidden;display:flex;flex-direction:column}
  .card .head{display:flex;align-items:center;gap:10px;justify-content:space-between;padding:12px;border-bottom:1px solid var(--stroke)}
  .card .head h2{margin:0;font-size:14px;font-weight:700}
  .frame{position:relative;aspect-ratio:16/9;width:100%;background:#000}
  .frame > iframe{position:absolute;inset:0;width:100%;height:100%;border:0}
  .list{padding:12px; display:grid; gap:12px}
  .item{display:flex;align-items:center;gap:12px;flex-wrap:wrap;border:1px solid var(--stroke);border-radius:12px;padding:10px}
  .item h3{margin:0;font-size:14px}
  .muted{color:var(--muted)}
  details.debug{padding:8px 12px;border-top:1px dashed var(--stroke);font-size:12px;color:var(--muted)}
  footer{display:flex;justify-content:flex-end;gap:10px;align-items:center;padding-top:8px;border-top:1px solid var(--stroke)}
</style>
</head>
<body>
<div class="wrap">

  <!-- Top -->
  <header class="app">
    <h1>KLIMT — Video & PDF Downloads</h1>
  </header>

  <!-- Main -->
  <div class="grid">

    <!-- Left: YouTube -->
    <section class="card" aria-label="Video">
      <div class="head"><h2>Product Teaser</h2></div>
      <div class="frame">
        <iframe id="yt" title="YouTube video" allow="autoplay; encrypted-media; picture-in-picture; web-share"
                allowfullscreen loading="lazy" referrerpolicy="strict-origin-when-cross-origin"></iframe>
      </div>
    </section>

    <!-- Right: PDFs (Download only) -->
    <section class="card" aria-label="Documents">
      <div class="head">
        <h2>Documents</h2>
      </div>

      <div id="docList" class="list" aria-live="polite"></div>

      <details class="debug" id="debug">
        <summary>Debug</summary>
        <div id="debugBody">Ready.</div>
      </details>
    </section>
  </div>

  <!-- Bottom -->
  <footer>
    <div class="muted">Downloads try Pages → Raw → Local and save as real PDFs.</div>
  </footer>
</div>

<script>
  /* ========================== CONFIG — EDIT THESE ==========================
   *
   * 1) YOUTUBE VIDEO
   *    Replace YT_ID with the 11-character ID from your video URL.
   *    Example: https://www.youtube.com/watch?v=cLHOGWiA6YQ  ->  "cLHOGWiA6YQ"
   *
   * 2) PDF LOCATIONS (DOCS array)
   *    Each item may include up to THREE paths:
   *      - pages: absolute GitHub Pages URL (recommended for public hosting)
   *      - raw:   absolute raw.githubusercontent.com URL (direct file in repo)
   *      - local: relative path next to this HTML (works when hosted together)
   *
   *    Use any subset (1–3). The downloader will try Pages, then Raw, then Local.
   *    Filenames on Pages are case-sensitive. Avoid GitHub “blob” URLs entirely.
   * ======================================================================= */

  const YT_ID = "cLHOGWiA6YQ";  // <-- EDIT for your YouTube video

  const DOCS = [
    {
      label: "KLIMT STG",
      filename: "KLIMT-STG.pdf",
      paths: {
        pages: "https://ctlamedicamarketing.github.io/qr-redirects/docs/KLIMT-STG.pdf",
        raw:   "https://raw.githubusercontent.com/ctlamedicamarketing/qr-redirects/main/docs/KLIMT-STG.pdf",
        local: "KLIMT-STG.pdf"
      }
    },
    {
      label: "Klimt Expansion Table & Tips",
      filename: "Klimt-Expansion-Table-and-Tips.pdf",
      paths: {
        pages: "https://ctlamedicamarketing.github.io/qr-redirects/docs/Klimt-Expansion-table-and-Tips.pdf",
        raw:   "https://raw.githubusercontent.com/ctlamedicamarketing/qr-redirects/main/docs/Klimt-Expansion-table-and-Tips.pdf",
        local: "Klimt-Expansion-table-and-Tips.pdf"
      }
    },
    {
      label: "Klimt Expansion Table",
      filename: "Klimt-Expansion-Table.pdf",
      paths: {
        pages: "https://ctlamedicamarketing.github.io/qr-redirects/docs/Klimt-Expansion-table.pdf",
        raw:   "https://raw.githubusercontent.com/ctlamedicamarketing/qr-redirects/main/docs/Klimt-Expansion-table.pdf",
        local: "Klimt-Expansion-table.pdf"
      }
    }
  ];

  /* ============================ END CONFIG ============================ */

  // --------- YouTube init ----------
  (function initYouTube(){
    const yt = document.getElementById('yt');
    const origin = location.origin;
    const params = new URLSearchParams({
      autoplay:'0', mute:'1', controls:'1', modestbranding:'1', rel:'0',
      playsinline:'1', loop:'1', playlist:YT_ID, enablejsapi:'1', origin
    });
    yt.src = `https://www.youtube.com/embed/${YT_ID}?` + params.toString();
  })();

  // --------- URL resolvers ----------
  async function tryHead(url){
    try {
      const res = await fetch(url, { method:'HEAD', cache:'no-store', mode:'cors' });
      return res.ok ? res : null;
    } catch { return null; }
  }

  async function resolveUrl(paths){
    // 1) GitHub Pages
    if (paths.pages) {
      const r = await tryHead(paths.pages);
      if (r) return paths.pages;
    }
    // 2) Raw GitHub
    if (paths.raw) {
      const r = await tryHead(paths.raw);
      if (r) return paths.raw;
    }
    // 3) Local relative (HEAD may be blocked on some static hosts; allow anyway)
    if (paths.local) {
      try { return new URL(paths.local, location.href).toString(); }
      catch { return paths.local; }
    }
    return null;
  }

  // Try to infer a filename from headers (Content-Disposition) or URL
  function inferFilename(url, headers, fallback){
    const cd = headers?.get?.('content-disposition');
    if (cd){
      const m = cd.match(/filename\*?=(?:UTF-8''|")?([^\";]+)\"?/i);
      if (m && m[1]) { try { return decodeURIComponent(m[1]); } catch { return m[1]; } }
    }
    try {
      const u = new URL(url);
      const last = u.pathname.split('/').pop();
      if (last && /\./.test(last)) return last;
    } catch {}
    return fallback || 'download.pdf';
  }

  // --------- Force download (fetch → blob → save) ----------
  async function forceDownload(paths, suggestedName, btn){
    const url = await resolveUrl(paths);
    if (!url) { alert('No valid download URL found.'); return; }

    const originalText = btn.textContent;
    btn.textContent = "Downloading…";
    btn.disabled = true;

    try {
      const res = await fetch(url, { mode:'cors', credentials:'omit', cache:'no-store' });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);

      const ct = (res.headers.get('content-type') || '').toLowerCase();
      if (!ct.includes('application/pdf')) {
        // Some servers omit the type; allow if the URL ends with .pdf
        if (!/\.pdf(\?|#|$)/i.test(url)) throw new Error(`Not a PDF (content-type: ${ct || 'unknown'})`);
      }

      const blob = await res.blob();
      const filename = inferFilename(url, res.headers, suggestedName);

      const a = document.createElement('a');
      const objectUrl = URL.createObjectURL(blob);
      a.href = objectUrl; a.download = filename;
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(objectUrl);

      btn.textContent = "Downloaded ✓";
    } catch (err){
      console.warn('Direct download failed; opening instead:', err);
      window.open(url, '_blank', 'noopener');
      btn.textContent = "Opened in new tab";
    } finally {
      setTimeout(()=>{ btn.textContent = originalText; btn.disabled = false; }, 1800);
    }
  }

  // --------- Build UI ----------
  const els = { docList: document.getElementById('docList'), debugBody: document.getElementById('debugBody') };

  async function populateDocs(){
    for (const d of DOCS){
      const row = document.createElement('div');
      row.className = 'item';

      const title = document.createElement('h3');
      title.textContent = d.label;

      const download = document.createElement('button');
      download.className = 'btn';
      download.type = 'button';
      download.textContent = 'Download';
      download.addEventListener('click', ()=> forceDownload(d.paths, d.filename, download));

      row.appendChild(title);
      row.appendChild(download);
      els.docList.appendChild(row);

      // Debug lines (optional)
      const tests = [
        ['Pages', d.paths.pages],
        ['Raw',   d.paths.raw],
        ['Local', d.paths.local ? new URL(d.paths.local, location.href).toString() : null]
      ];
      for (const [label, url] of tests){
        if (!url) continue;
        let status = '…';
        try {
          const head = await tryHead(url);
          status = head ? '✅' : '⚠️ (HEAD failed)';
        } catch { status = '⚠️'; }
        const p = document.createElement('p');
        p.innerHTML = `• <b>${d.label}</b> – ${label}: <a href="${url}" target="_blank" rel="noopener">${url}</a> ${status}`;
        els.debugBody.appendChild(p);
      }
    }
  }

  populateDocs();
</script>
</body>
</html>
